<!-- app/web/views/schools/manage.ejs -->
<section class="content-header">
  <h1><%= pageTitle %></h1>
</section>

<section class="content">

  <% if (success) { %>
    <div class="alert alert-success"><%= success %></div>
  <% } %>
  <% if (error) { %>
    <div class="alert alert-danger"><%= error %></div>
  <% } %>

  <div class="alert alert-warning" style="border-left:4px solid #ffc107">
    <strong>Warning:</strong> Fields use interactive update. Be careful with accidental edits.
  </div>

  <div class="card card-outline card-primary">
    <div class="card-header"><h3 class="card-title">Add School</h3></div>
    <form method="post" action="/staff/schools/create">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <div class="card-body">
        <div class="form-inline">
          <input name="name" class="form-control mr-2" placeholder="School name" style="min-width:320px" required>
          <button class="btn btn-primary">Save</button>
        </div>
      </div>
    </form>
  </div>

  <div class="card card-outline card-secondary">
    <div class="card-header d-flex align-items-center">
      <h3 class="card-title">Existing Schools</h3>
      <form class="form-inline ml-auto" method="get" action="/staff/schools">
        <input name="q" class="form-control form-control-sm mr-2" placeholder="Search nameâ€¦" value="<%= q || '' %>">
        <button class="btn btn-sm btn-outline-secondary">Search</button>
      </form>
    </div>

    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0">
        <thead>
          <tr><th style="width:60px">#</th><th>Name</th><th style="width:180px">Action</th></tr>
        </thead>
        <tbody>
          <% if (!schools || !schools.length) { %>
            <tr><td colspan="3" class="text-center text-muted p-4">No records.</td></tr>
          <% } else { schools.forEach((s,i) => { %>
            <tr>
              <td><%= (page-1)*pageSize + i + 1 %></td>
              <td>
                <form class="form-inline" method="post" action="/staff/schools/<%= s.id %>/update">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <input name="name" class="form-control" value="<%= s.name %>" style="min-width:360px">
                  <button class="btn btn-sm btn-primary ml-2">Update</button>
                </form>
              </td>
              <td class="text-right pr-3">
                <form method="post" action="/staff/schools/<%= s.id %>/delete" onsubmit="return confirm('Delete this school (and its departments)?');">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button class="btn btn-sm btn-danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }) } %>
        </tbody>
      </table>
    </div>

    <div class="card-footer text-center">
      <% const pages = Math.ceil((total||0) / pageSize); %>
      <% if (pages > 1) { %>
        <nav>
          <ul class="pagination justify-content-center">
            <li class="page-item <%= page===1?'disabled':'' %>">
              <a class="page-link" href="?q=<%= encodeURIComponent(q||'') %>&page=<%= page-1 %>">Prev</a>
            </li>
            <% for (let p=1; p<=pages; p++) { %>
              <li class="page-item <%= p===page?'active':'' %>">
                <a class="page-link" href="?q=<%= encodeURIComponent(q||'') %>&page=<%= p %>"><%= p %></a>
              </li>
            <% } %>
            <li class="page-item <%= page===pages?'disabled':'' %>">
              <a class="page-link" href="?q=<%= encodeURIComponent(q||'') %>&page=<%= page+1 %>">Next</a>
            </li>
          </ul>
        </nav>
      <% } %>
    </div>
  </div>
</section>
